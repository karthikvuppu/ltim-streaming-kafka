.kafka-endpoints-deploy:
  stage: kafka-endpoints-deploy
  extends:
  - .helm-common
  - .authenticate
  script:
    - 'helm upgrade 
     --install kafka-endpoints-monitor charts/kafka-endpoints-monitor
     --namespace confluent 
     -f tooling/kafka-endpoints-monitor/production/values.yaml
     --set host=$EKS_CLUSTER
     --set KAFKA_MONITOR=$KAFKA_MONITOR
     --kube-context $EKS_CLUSTER'
  rules:
    #- if: '$CI_COMMIT_BRANCH == "prodation" || $CI_COMMIT_BRANCH == "main"'
    #- if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - changes:
        - tooling/kafka-endpoints-monitor/production/values.yaml
  when: manual
