# Default values for kafka-eks
# This is a YAML-formatted file.

# Strimzi Kafka Operator
strimzi:
  enabled: true
  watchNamespaces: []

# Kafka Cluster Configuration
kafka:
  # Cluster name
  name: my-kafka

  # Kafka version
  version: 3.6.0

  # Number of Kafka brokers
  replicas: 3

  # Pod Security Context (enable in production)
  podSecurityContext:
    enabled: false
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 0
    seccompProfile:
      type: RuntimeDefault

  # Listeners configuration
  listeners:
    plain:
      enabled: true
      port: 9092
      type: internal
      tls: false

    external:
      enabled: true
      port: 9094
      type: loadbalancer
      tls: false  # Set to true in production environments
      authentication:
        type: ""  # Set to scram-sha-512 in production environments
      annotations:
        service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
        service.beta.kubernetes.io/aws-load-balancer-internal: "true"

    tls:
      enabled: false
      port: 9093
      type: internal
      authentication:
        type: ""  # scram-sha-512, tls, oauth

  # Authorization configuration
  authorization:
    type: ""  # Set to "simple" in production for ACL-based authorization
    superUsers: []

  # Kafka broker configuration
  config:
    offsets.topic.replication.factor: 3
    transaction.state.log.replication.factor: 3
    transaction.state.log.min.isr: 2
    default.replication.factor: 3
    min.insync.replicas: 2
    inter.broker.protocol.version: "3.6"
    log.retention.hours: 168  # 7 days
    log.segment.bytes: 1073741824  # 1GB
    num.network.threads: 3
    num.io.threads: 8
    socket.send.buffer.bytes: 102400
    socket.receive.buffer.bytes: 102400
    socket.request.max.bytes: 104857600
    auto.create.topics.enable: true  # Disable in production (set to false)

  # Storage configuration
  storage:
    type: jbod
    class: gp2
    size: 10Gi
    deleteClaim: false

  # Resource limits and requests
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m

  # JVM Options
  jvmOptions:
    xms: 1024m
    xmx: 2048m

  # Logging
  logging:
    level: INFO
    # Audit logging configuration (enable in production)
    auditLogging:
      enabled: false
      loggers:
        kafka.authorizer.logger: "INFO, AUTHORIZERAPPENDER"
      appenders: |
        # Audit log appender
        log4j.appender.AUTHORIZERAPPENDER=org.apache.log4j.RollingFileAppender
        log4j.appender.AUTHORIZERAPPENDER.File=/var/log/kafka/kafka-authorizer.log
        log4j.appender.AUTHORIZERAPPENDER.MaxFileSize=100MB
        log4j.appender.AUTHORIZERAPPENDER.MaxBackupIndex=10
        log4j.appender.AUTHORIZERAPPENDER.layout=org.apache.log4j.PatternLayout
        log4j.appender.AUTHORIZERAPPENDER.layout.ConversionPattern=[%d] %p %m (%c)%n

  # Metrics
  metrics:
    enabled: true

# Zookeeper Configuration
zookeeper:
  # Number of Zookeeper nodes (must be odd)
  replicas: 3

  # TLS configuration (enable in production)
  tls:
    enabled: false

  # Pod Security Context (enable in production)
  podSecurityContext:
    enabled: false
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 0
    seccompProfile:
      type: RuntimeDefault

  # Storage configuration
  storage:
    type: persistent-claim
    class: gp2
    size: 5Gi
    deleteClaim: false

  # Resource limits and requests
  resources:
    requests:
      memory: 1Gi
      cpu: 250m
    limits:
      memory: 2Gi
      cpu: 1000m

  # JVM Options
  jvmOptions:
    xms: 512m
    xmx: 1024m

  # Logging
  logging:
    level: INFO

  # Metrics
  metrics:
    enabled: true

# Entity Operator (Topic and User management)
entityOperator:
  enabled: true

  topicOperator:
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m

  userOperator:
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 500m

# Example Topics (deployed with chart)
topics:
  enabled: false
  topics:
    - name: test-topic
      partitions: 3
      replicas: 3
      config:
        retention.ms: 604800000  # 7 days
        segment.bytes: 1073741824  # 1GB
        compression.type: producer
        min.insync.replicas: 2

# Monitoring
monitoring:
  # Enable Prometheus ServiceMonitor
  serviceMonitor:
    enabled: false
    namespace: monitoring
    interval: 30s

  # Enable PodMonitor
  podMonitor:
    enabled: false
    namespace: monitoring
    interval: 30s

# Namespace to deploy into
namespaceOverride: ""

# Storage Class (for encrypted volumes)
storageClass:
  enabled: false  # Enable in production
  name: kafka-gp3-encrypted
  provisioner: ebs.csi.aws.com
  type: gp3
  encrypted: true
  kmsKeyId: ""  # Optional: Specify KMS key ARN for encryption
  iops: 3000
  throughput: 125
  volumeBindingMode: WaitForFirstConsumer
  allowVolumeExpansion: true
  reclaimPolicy: Retain

# Network Policy
networkPolicy:
  enabled: false  # Enable in production
  allowedNamespaces:
    - default  # List namespaces that can access Kafka
  monitoringNamespace: monitoring
  allowExternalEgress: true  # Allow Kafka to make external connections

# Kafka Users (for ACL-based authentication)
users:
  enabled: false
  users: []
    # Example user configuration:
    # - name: my-app-user
    #   authentication:
    #     type: scram-sha-512
    #   authorization:
    #     type: simple
    #     acls:
    #       - resource:
    #           type: topic
    #           name: my-topic
    #           patternType: literal
    #         operations: [Read, Write, Describe]
    #       - resource:
    #           type: group
    #           name: my-consumer-group
    #           patternType: literal
    #         operations: [Read]
